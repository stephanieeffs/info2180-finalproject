<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Login</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link to external CSS -->
    <script src="logout.js" defer></script>
</head>
<body>
    <!-- User Login Form -->
    <div id="login-form">
        <h2>Login</h2>
        <form id="login">
            <input type="email" id="email" placeholder="Email Address" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="button" onclick="loginUser()">Login</button>
        </form>
        <p id="login-error">Invalid login credentials. Please try again.</p>
    </div>

    <!-- Add User Form (Admin Only) -->
    <div id="add-user-form" class="hidden">
        <h2>Add User</h2>
        <form id="addUser">
            <input type="text" id="first_name" placeholder="First Name" required>
            <input type="text" id="last_name" placeholder="Last Name" required>
            <input type="email" id="new_email" placeholder="Email Address" required>
            <input type="password" id="new_password" placeholder="Password" required>
            <select id="role" required>
                <option value="Member">Member</option>
                <option value="Admin">Admin</option>
            </select>
            <button type="button" onclick="addUser()">Add User</button>
        </form>
        <p id="add-user-success">User added successfully!</p>
        <p id="add-user-error">Failed to add user. Please check inputs.</p>
    </div>

     <!-- View Users Section -->
     <div id="viewUsers-section" class="hidden">
        <h2>List of Users</h2>
        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Date Created</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- User data will be dynamically inserted here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Logout Section -->
    <script>
        // Toggle Sections
        function showSection(section) {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('addUser-section').classList.add('hidden');
            document.getElementById('viewUsers-section').classList.add('hidden');
            document.getElementById(`${section}-section`).classList.remove('hidden');
        }

        // Fetch View Users Data
        function loadViewUsers() {
            fetch('view_users.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const tableBody = document.getElementById('userTableBody');
                        tableBody.innerHTML = ""; // Clear existing data
                        data.data.forEach(user => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${user.first_name} ${user.last_name}</td>
                                <td>${user.email}</td>
                                <td>${user.role}</td>
                                <td>${user.created_at}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Add Logout Functionality
        document.addEventListener("DOMContentLoaded", () => {
            const logoutButton = document.getElementById("logout-button");
            if (logoutButton) {
                logoutButton.addEventListener("click", logoutUser);
            }
        });
    </script>

    <script src="login.js"></script> 
</body>
</html>
